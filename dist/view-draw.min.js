/**
 * view-draw 0.0.3
 * @license MIT
 * Copyright 2021-present Jasper Palfree
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ViewDraw={})}(this,(function(t){"use strict";var e=function(t,e,i){return t*(1-i)+e*i},i=function(t,e,i){var n=e-t;return n?(i-t)/n:1},n=function(t,i){return[e(i[0],i[1],t[0]),e(i[2],i[3],t[1])]},r=function(t,e){return[i(e[0],e[1],t[0]),i(e[2],e[3],t[1])]},o=function(t,e){var i=t.name,o=t.to,a=t.from;void 0===e&&(e=[0,1,0,1]);var s={name:i,to:o,from:a,viewbox:e,toCameraSize:function(t,e){return(t[1]-t[0])*e/(s.viewbox[1]-s.viewbox[0])},fromCameraSize:function(t,e){var i=t[1]-t[0];return(s.viewbox[1]-s.viewbox[0])*e/i},toCamera:function(t,e){return n(o(r(e,s.viewbox)),t)},fromCamera:function(t,e){return n(a(r(e,t)),s.viewbox)}};return s},a=2*Math.PI,s={to:function(t){return t},from:function(t){return t}},c={to:function(t){var e=t[0],i=t[1];return i*=a,[e*Math.cos(i),e*Math.sin(i)]},from:function(t){var e=t[0],i=t[1];return[Math.sqrt(e*e+i*i),Math.atan2(i,e)/a]}},h=Object.freeze({__proto__:null,makeProjection:o,cartesian:s,polar:c});function u(t){for(var e=0,i=0,n=t.length,r=0;r<n;r++){var o=t[r];e+=o[0],i+=o[1]}return[e/n,i/n]}function d(t,e,i,n){void 0===n&&(n=!0);var r=Math.max(t,e,i);if(r===t){var o=[i,t];t=o[0],i=o[1]}else if(r===e){var a=[i,e];e=a[0],i=a[1]}var s=0===t?0:(t*t-e*e+i*i)/(2*i),c=[[0,0],[s,Math.sqrt(t*t-s*s)],[i,0]];if(n)for(var h=u(c),d=h[0],l=h[1],v=0,f=c.length;v<f;v++)c[v][0]-=d,c[v][1]-=l;return c}var l=Object.freeze({__proto__:null,centroid:u,triangleFromSides:d}),v=[0,1,0,1],f=function(){function t(t,e){this.proj=t,this.projCanonical=o(s),this.options=e,this.saveStateCount=0,this._internalState=[]}t.create=function(e,i){return void 0===i&&(i={}),new t(e,i)};var e=t.prototype;return e.init=function(t,e){t!==this.canvas&&(this.canvas=t,this.ctx=t.getContext("2d")),this._useCanonical=!1,this.width=t.width,this.height=t.height,this.bounds=t.getBoundingClientRect();var i=this.width/this.bounds.width,n=.5*this.width/i,r=.5*this.height/i,o="fit"===this.options.scaleMode?Math.min(n,r):Math.max(n,r),a=o*e.scale,s=this.proj.toCamera(v,e.center);return this.cameraBounds=[-s[0]*a+n,(1-s[0])*a+n,-s[1]*a+r,(1-s[1])*a+r],this.worldUnit=[0,o,0,o],this.worldScale=[0,a,0,a],this.ctx.setTransform(i,0,0,i,0,0),this},e.canonical=function(t){return void 0===t&&(t=!0),this._useCanonical=t,this},e.toCamera=function(t){return this._useCanonical?this.projCanonical.toCamera(this.cameraBounds,t):this.proj.toCamera(this.cameraBounds,t)},e.toCameraSize=function(t){return this._useCanonical?this.projCanonical.toCameraSize(this.cameraBounds,t):this.proj.toCameraSize(this.cameraBounds,t)},e.save=function(){return this.saveStateCount++,this._internalState.push({_useCanonical:this._useCanonical}),this.ctx.save(),this},e.restore=function(){this.ctx.restore();var t=this._internalState.pop();return Object.assign(this,t),this.saveStateCount=Math.max(this.saveStateCount-1,0),this},e.end=function(){this.saveStateCount&&window.console.warn("Warning: Forgot to call restore() after save().")},e.clear=function(){return this.ctx.clearRect(0,0,this.width,this.height),this},e.color=function(t){return t?(this.ctx.fillStyle!==t&&(this.ctx.fillStyle=t),this.ctx.strokeStyle!==t&&(this.ctx.strokeStyle=t),this):this},e.style=function(t,e){if(void 0!==e&&e)return this.ctx[t]=e,this;for(var i in t){var n=t[i];this.ctx[i]!==n&&n&&(this.ctx[i]=n)}return this},e.translate=function(t){var e=this.ctx,i=this._useCanonical?this.projCanonical.toCamera(this.worldScale,t):this.proj.toCamera(this.worldScale,t),n=i[0],r=i[1];return e.translate(n,r),this},e.rotate=function(t){var e=this.toCamera([0,0]);return this.ctx.translate(e[0],e[1]),this.ctx.rotate(t),this.ctx.translate(-e[0],-e[1]),this},e.dot=function(t,e){void 0===e&&(e=1);var i=this.ctx,n=this.toCamera(t),r=n[0],o=n[1];return i.beginPath(),i.arc(r,o,e,0,2*Math.PI),i.fill(),this},e.paint=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=0);var i=this.ctx;return t&&i.fill(),e&&(this.style("lineWidth",e),i.stroke()),this},e.text=function(t,e,i){var n=void 0===i?{}:i,r=n.font,o=void 0===r?"12px monospace":r,a=n.textAlign,s=void 0===a?"center":a,c=this.toCamera(e),h=c[0],u=c[1];return this.style("font",o).style("textAlign",s),this.ctx.fillText(t,h,u),this},e.arrow=function(t,e,i){var n=void 0===i?{}:i,r=n.stroke,o=void 0===r?1:r,a=n.scaleHead,s=void 0!==a&&a,c=n.headSize,h=void 0===c?6:c,u=n.headColor;this.path([t,e],!1,!1,o);var d=this.proj.fromCameraSize(s?this.worldUnit:this.cameraBounds,h);this.save(),this.translate(e),this.color(u);var l=function(t,e){var i=t[0],n=t[1],r=e[0],o=e[1];return r-=i,o-=n,Math.atan2(o,r)}(this.toCamera(t),this.toCamera(e));return this.rotate(l),this.canonical(!0),this.path([[0,0],[-d,d],[-d,-d]],!0,!0),this.restore(),this},e.circle=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0);var r=this.ctx,o=this.toCamera(t),a=o[0],s=o[1];return e=this.toCameraSize(e),r.beginPath(),r.arc(a,s,e,0,2*Math.PI),this.paint(i,n),this},e.path=function(t,e,i,n){if(void 0===e&&(e=!1),!t.length)return this;var r=this.ctx;r.beginPath();var o=this.toCamera(t[0]);r.moveTo(o[0],o[1]);for(var a=1,s=t.length;a<s;a++)o=this.toCamera(t[a]),r.lineTo(o[0],o[1]);return e&&r.closePath(),this.paint(i,n),this},e.triangle=function(t,e,i,n,r,o,a){var s=void 0===n?[0,0]:n,c=s[0],h=s[1];void 0===r&&(r=0);var u=d(t,e,i);return this.save(),this.translate([c,h]),this.rotate(r),this.canonical(!0),this.path(u,!0,o,a),this.restore(),this},t}();var m=function(t,e){void 0===t&&(t=[0,0]),void 0===e&&(e={});var i,n,r,o,a,s=Object.assign({friction:.02,threshold:.001,minFlick:.1,maxFlick:8},e),c=!1,h=t,u=0,d=[],l=0,v=window.performance.now.bind(window.performance);return{start:function(t){c=t,i=h.slice(0)},drag:function(t,e){if(void 0===e&&(e=1),c){d=h.slice(0),h[0]=i[0]+(t[0]-c[0])/e,h[1]=i[1]+(t[1]-c[1])/e;var n=v();l=Math.max(20,n-a),a=n}},stop:function(t,e){if(void 0===e&&(e=1),c)if(c=!1,v()-a>50)n=r=0;else{if(n=h[0]-d[0],r=h[1]-d[1],(o=Math.sqrt(n*n+r*r))<s.minFlick/e)o=0,n=0,r=0;else if(o>s.maxFlick/e){var i=s.maxFlick/e/o;n*=i,r*=i,o=s.maxFlick}n*=4/l,r*=4/l,o*=4/l}},set:function(t){var e=t[0],i=t[1];h[0]=e,h[1]=i},update:function(){var t=v();return c||function(t){if(n||r){var e=t-u;h[0]+=n*e,h[1]+=r*e,n&&(n-=s.friction*n),r&&(r-=s.friction*r),(n*n+r*r)/(o*o)<s.threshold*s.threshold&&(n=r=0)}}(t),u=t,h}}};t.createCanvas=function(t){var e=void 0===t?{}:t,i=e.autoResize,n=void 0===i||i,r=e.pixelRatio,o=void 0===r?window.devicePixelRatio||1:r,a=e.width,s=void 0===a?0:a,c=e.height,h=void 0===c?0:c,u=e.aspectRatio,d=void 0===u?null:u,l=e.el,v=void 0===l?document.body:l,f=e.background,m=void 0===f?"hsl(0, 0%, 10%)":f,p=e.onResize,w=void 0===p?function(){}:p,x="CANVAS"===v.tagName?v:document.createElement("canvas"),C=x.getContext("2d"),g=!s,y=!h,b={};x.style.display="flex",x.style.background=m,x.style.transform="scale("+1/o+")",x.style.transformOrigin="top left","CANVAS"!==v.tagName&&v.appendChild(x);var S=function(){var t=x.parentNode;t&&(g&&(s=t.clientWidth),y&&(h=d?s/d:t.clientHeight),b.width=s,b.height=h,x.style.marginBottom=(1-o)*h+"px",x.width=o*s,x.height=o*h,C.scale(o,o),w(b))};return n&&window.addEventListener("resize",S),S(),{canvas:x,ctx:C,destroy:function(){n&&window.removeEventListener("resize",S),x.parentNode&&x.parentNode.removeChild(x)},dimensions:b,refresh:S}},t.createDragger=m,t.createView=function(t,e,i,n){void 0===n&&(n={scaleMode:"fit"}),"string"==typeof t?t=h[t]:"object"!==t&&(i=e,e=t,t=s),Array.isArray(e)||(i=e,e=void 0);var r=o(t,e),a={center:[0,0],scale:1,proj:r},c=f.create(r,n);return a.toViewCoords=function(t,e,i){return void 0===i&&(i=!1),c.init(e,a),r.fromCamera(i?c.worldUnit:c.cameraBounds,t)},a.getMousePos=function(t,e,i){void 0===i&&(i=!1),c.init(e,a);var n=[t.pageX-c.bounds.left,t.pageY-c.bounds.top];return a.toViewCoords(n,e,i)},a.camera=function(t,e){return void 0===e&&(e=1),a.center=t,a.scale=e,a},a.draw=function(t){c.init(t,a),c.clear();for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return i.apply(void 0,[c].concat(n)),c.end(),a},a.drawOver=function(t){c.init(t,a);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return i.apply(void 0,[c].concat(n)),c.end(),a},a.setViewbox=function(t){return r.viewbox=t,a},a},t.createViewport=function(t,e){void 0===e&&(e={});var i={center:[0,0],zoom:1},n=new Map,r=function(e){var i=t.getBoundingClientRect();return[-(e.pageX-i.left),-(e.pageY-i.top)]},o=0,a=1,s=!1,c=function(t){if(2===n.size){var e,s,c,h,u,d,l=Array.from(n.values(),(function(t){return r(t)})),v=(e=l[0],s=l[1],c=e[0],h=e[1],u=s[0],d=s[1],d-=h,u-=c,Math.sqrt(u*u+d*d));o?i.zoom=a*v/o:(o=v,a=i.zoom)}},h=m(i.center,e),u=function(t){t.preventDefault(),i.zoom=function(t,e,i){return void 0===i&&(i=1),t.zoom*Math.pow(2,e*i)}(i,-t.deltaY,.001)},d=function(t){n.set(t.pointerId,t),h.start(r(t)),2===n.size&&(s=!0,h.stop(r(t),i.zoom))},l=function(t){n.set(t.pointerId,t),s?c():h.drag(r(t),i.zoom)},v=function(t){n.delete(t.pointerId),o=0,s||h.stop(r(t),i.zoom),0===n.size&&(s=!1)},f=t.style.touchAction;return t.style.touchAction="none",t.addEventListener("wheel",u),t.addEventListener("pointerdown",d),t.addEventListener("pointermove",l),window.addEventListener("pointerup",v),{state:i,setCenter:function(t){return h.set(t),this},update:function(){return i.center=h.update(),i},destroy:function(){t.style.touchAction=f,t.removeEventListener("wheel",u),t.removeEventListener("pointerdown",d),t.removeEventListener("pointermove",l),window.removeEventListener("pointerup",v)}}},t.geometry=l,Object.defineProperty(t,"__esModule",{value:!0})}));
